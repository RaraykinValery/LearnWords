#!/usr/bin/env python3.10
import argparse
import signal

from services import start_learn_loop, handler, greetings
from database import (
    create_table_if_not_exists,
    insert_text_and_translation_to_db,
)


def main() -> None:
    create_table_if_not_exists()

    parser = argparse.ArgumentParser(
        description="LearnWords is a programm to help you learn words easy!"
    )
    subparsers = parser.add_subparsers()
    parser.set_defaults(func=greetings)

    parser_add = subparsers.add_parser("add")
    parser_add.add_argument("text", type=str)
    parser_add.add_argument("translation", type=str)
    parser_add.set_defaults(func=add)

    parser_learn = subparsers.add_parser("learn")
    parser_learn.set_defaults(func=learn)

    args = parser.parse_args()
    args.func(args)


def add(args: argparse.Namespace) -> None:
    insert_text_and_translation_to_db(args.text, args.translation)
    print(f"Translation is added!")


def learn(args: argparse.Namespace) -> None:
    start_learn_loop()


if __name__ == "__main__":
    signal.signal(signal.SIGINT, handler)
    main()
